# Dockerfile and CLI Quick Reference

## Dockerfile Instructions

- **FROM `<image>`**  
  Sets the base image for subsequent instructions. Dockerfile must start with a `FROM` instruction.
  
- **MAINTAINER `<name>`**  
  Sets the `Author` field for the generated images.
  
- **LABEL**  
  Adds metadata to an image. A label is a key-value pair.  
  Examples:
  - `LABEL <key>=<value> <key2>=<value2> ...`
  - `LABEL <key> <value>`

- **RUN**  
  Executes any commands in a new layer on top of the current image and commits the results.  
  Two forms:
  - `RUN <command>`: Runs the command in the shell `/bin/sh -c`
  - `RUN ["<executable>", "<param1>", "<param2>"]`: Executable form (square brackets are part of the syntax).

- **CMD**  
  Provides defaults for executing the container. There can be at most one `CMD` instruction in a Dockerfile.  
  Examples:
  - `CMD ["<executable>", "<param1>", "<param2>"]`
  - `CMD ["<param1>", "<param2>"]`: Provide default arguments to `ENTRYPOINT`
  - `CMD <command args ...>`: Runs the command in the shell `/bin/sh -c`

- **ENTRYPOINT**  
  Configures a container that can be run as an executable. Unlike `CMD`, the `ENTRYPOINT` instruction adds an entry command that is not overwritten when arguments are passed to `docker run`.  
  Examples:
  - `ENTRYPOINT ["<executable>", "<param1>", "<param2>"]`: Executable form.
  - `ENTRYPOINT <command param1 param2 ...>`: Runs the command in the shell `/bin/sh -c`

- **EXPOSE `<port1> <port2> ...`**  
  Informs Docker that the container listens on the specified network ports at runtime.

- **ENV `<key> <value>`**  
  Sets the environment variable `<key>` to the value `<value>`. This value is passed to all future `RUN`, `ENTRYPOINT`, and `CMD` instructions.

- **COPY `<src> <dest>`**  
  Copies new files, directories, or remote file URLs to the filesystem of the container at path `<dest>`.  
  Examples:
  - `COPY <src> <dest>`
  - `COPY ["<src>", ... "<dest>"]`

- **ADD `<src> <dest>`**  
  Like `COPY`, but additionally allows `<src>` to be a URL, and if `<src>` is an archive in a recognized format, it will be unpacked. **Best practice**: prefer `COPY`.

- **VOLUME `["/some/path"]`**  
  Creates a mount point with the specified name and marks it as holding externally-mounted volumes from the native host or from other containers.

- **USER `<user>` or `<user>:<group>`**  
  Sets the username or UID used for running subsequent commands.

- **WORKDIR `/path/to/workdir`**  
  Sets the working directory for the `RUN`, `CMD`, `ENTRYPOINT`, `COPY`, and `ADD` instructions that follow.

- **ARG `<name>` or `<name>=<default value>`**  
  Defines a variable that users can pass at build-time to the builder with the `docker build` command using the `--build-arg <varname>=<value>` flag.

- **ONBUILD `<instruction>`**  
  Adds a trigger instruction to an image. The trigger is executed later when the image is used as the base for another build.

---

## Docker CLI Quick Reference

### Building Images

- **`docker build [<opts>] <path> | <URL>`**  
  Build a new image from the source code at `<path>`.  
  Options:
  - `-f, --file path/to/Dockerfile`: Path to the Dockerfile to use (default: Dockerfile).
  - `--build-arg <varname>=<value>`: Name and value of a build argument defined with `ARG` Dockerfile instruction.
  - `-t "<name>[:<tag>]"`: Repository names (and optionally with tags) to be applied to the resulting image.
  - `--label =<label>`: Set metadata for an image.
  - `-q, --quiet`: Suppress the output generated by containers.
  - `--rm`: Remove intermediate containers after a successful build.

### Creating, Running, and Stopping Containers

- **`docker run [<opts>] <image> [<command>] [<arg>...]`**  
  Run a command in a new container.  
  Options:
  - `-i, --interactive`: Keep STDIN open even if not attached.
  - `-t, --tty`: Allocate a pseudo-TTY.
  - `-v, --volume [<host-dir>:]<container-dir>[:<opts>]`: Bind mount a volume.
  - `--device =<host-dev>:<container-dev>[:<opts>]`: Add a host device to the container.
  - `-d, --detach`: Detached (daemon) mode.
  - `-e, --env NAME[="value"]`: Set environment variable.
  - `--env-file file`: Read in a line delimited file of environment variables.
  - `--entrypoint "some/entry/point"`: Overwrite the default ENTRYPOINT of the image.
  - `-h, --hostname ="<hostname>"`: Container host name.
  - `--add-host =<hostname>:<ip>`: Add a custom host-to-IP mapping.
  - `--net ="<mode>"`: Set the network mode for the container.
  - `--group-add =<groups>`: Add additional groups to run as.
  - `--rm`: Automatically remove the container when it exits.
  - `--restart ="no|on-failure[:<max-retry>]|always|unless-stopped"`: Restart policy.
  - `--name "foo"`: Assign a name to the container.
  - `--detach-keys ="<keys>"`: Override the key sequence to detach a container.

- **`docker create [<opts>] <image> [<command>] [<arg>...]`**  
  Create a new container, but don’t run it (instead, print its ID).

- **`docker start [<opts>] <container> [<container>...]`**  
  Start one or more containers.  
  Options:
  - `-a, --attach`: Attach container’s STDOUT and STDERR.
  - `-i, --interactive`: Attach container’s STDIN.

- **`docker stop [<opts>] <container> [<container>...]`**  
  Stop one or more containers by sending SIGTERM and then SIGKILL after a grace period.  
  Options:
  - `-t, --time [=10]`: Number of seconds to wait before killing the container.

- **`docker kill [<opts>] <container> [<container>...]`**  
  Kill a running container using SIGKILL or a specified signal.  
  Options:
  - `-s, --signal [="KILL"]`: Signal to send to the container.

- **`docker pause <container> [<container>...]`**  
  Pause all processes within a container.

- **`docker unpause <container> [<container>...]`**  
  Unpause all processes within a container.

---

### Interacting with Running Containers

- **`docker attach [<opts>] <container>`**  
  Attach to a running container.  
  Options:
  - `--no-stdin`: Do not attach STDIN (i.e., attach in read-only mode).
  - `--detach-keys ="<keys>"`: Override the key sequence to detach a container.

- **`docker exec [<opts>] <container> <command> [<arg>...]`**  
  Run a process in a running container.  
  Options:
  - `-i, --interactive`: Keep STDIN open even if not attached.
  - `-t, --tty`: Allocate a pseudo-TTY.
  - `-d, --detach`: Detached (daemon) mode.

- **`docker top <container> [<ps options>]`**  
  Display the running processes within a container.

- **`docker cp [<opts>] <container>:<src path> <host dest path>`**  
  Copy files/folders between a container and the local filesystem.

- **`docker logs [<opts>] <container>`**  
  Fetch the logs of a container.  
  Options:
  - `-f, --follow`: Follow log output.
  - `--since ="<timestamp>"`: Show logs since the given timestamp.
  - `-t, --timestamps`: Show timestamps.
  - `--tail ="<n>"`: Output the specified number of lines at the end of logs.

- **`docker wait <container> [<container>...]`**  
  Block until a container stops, then print its exit code.

---

### Saving and Loading Images and Containers

- **`docker save [<opts>] <image> [<image>...]`**  
  Save one or more images to a tar archive.

- **`docker load [<opts>]`**  
  Load image(s) from a tar archive.

- **`docker export [<opts>] <container>`**  
  Export a container’s filesystem as a tar archive.

- **`docker import [<opts>] <file>|<URL>|- [<repository>[:<tag>]]`**  
  Import the contents from a tarball to create a filesystem image.

---

### Communicating with Docker Registry

- **`docker login [<opts>] [<server>]`**  
  Log in to a Docker registry.

- **`docker logout [<server>]`**  
  Log out from a Docker registry.

- **`docker push [<registry host>[:<registry port>]/]<name>[:<tag>]`**  
  Push an image or a repository to a registry.

- **`docker pull [<opts>] [<registry host>[:<registry port>]/]<name>[:<tag>]`**  
  Pull an image or a repository from a registry.  
  Options:
  - `-a, --all-tags`: Download all tagged images in the repository.

---

### Listing Images and Containers

- **`docker images [<opts>]`**  
  List images.  
  Options:
  - `-a, --all`: Show all images (default hides intermediate images).
  - `--no-trunc`: Don’t truncate output.
  - `-f, --filter="<filter>"`: Filter output based on conditions provided.

- **`docker ps [<opts>]`**  
  List containers.  
  Options:
  - `-a, --all`: Show all containers (default shows just running).
  - `--no-trunc`: Don’t truncate output.
  - `-q, --quiet`: Display only numeric IDs.
  - `-f, --filter="<filter>"`: Filter output based on conditions provided.

---

### Inspecting Images and Containers

- **`docker inspect [<opts>] <container>|<image>`**  
  Return low-level information on Docker objects.  
  Options:
  - `-f, --format="<format>"`: Format the output using a Go template.
  - `-s, --size`: Display total file sizes.
  - `-t, --type="<container>|<image>"`: Return JSON for specified type.

---

### Removing Images and Containers

- **`docker rm [<opts>] <container> [<container>...]`**  
  Remove one or more containers.  
  Options:
  - `-f, --force`: Force the removal of a running container (uses SIGKILL).
  - `-v, --volume`: Remove anonymous volumes associated with the container.

- **`docker rmi [<opts>] <image> [<image>...]`**  
  Remove one or more images.  
  Options:
  - `-f, --force`: Force removal of the image.
  - `--no-prune`: Do not delete untagged parents.
